# ワイチャ！

オンラインセミナーでワイワイチャットできるリアルタイム反応システムです。

## 機能

### 基本機能
- 匿名でのリアルタイム反応・質問投稿
- 質問・コメントのチャット形式表示
- 文字による反応送信（背景フローティング表示）
- 自動スクロール機能（最下部にいる時のみ）
- Room管理

### 新機能（v2.1）
- **投稿分類システム**: 「質問」と「コメント」を分けて管理
- **質問専用回答機能**: 質問にのみ回答を投稿可能
- **改行対応**: Shift+Enterで改行入力
- **スクロール機能**: 過去の投稿をスクロールして確認
- **色分け反応**: 反応ごとに異なる色で表示
- **UI改善**: 見やすい文字色、回答ボタンの追加

## 技術スタック

- **フロントエンド**: Next.js 14+, React, TypeScript
- **リアルタイム通信**: Socket.IO
- **スタイリング**: TailwindCSS
- **開発環境**: Node.js, npm

## セットアップ

1. 依存関係のインストール
```bash
npm install
```

2. 開発サーバーの起動
```bash
# Socket.IOサーバーとNext.jsを同時に起動
npm run dev-all

# または個別に起動
npm run server  # Socket.IOサーバー (ポート3001)
npm run dev     # Next.jsサーバー (ポート3000)
```

## ローカルネットワークでの利用

**v2.1.1で追加：動的ホスト名対応**

同一ネットワーク内の他のデバイスからアクセスする場合：

1. PCのIPアドレスを確認
```bash
# Windows
ipconfig

# Linux/Mac
ip addr show
# または
ifconfig
```

2. 他のデバイスから以下のURLでアクセス
```
http://[PCのIPアドレス]:3000
```

例: `http://192.168.1.100:3000`

### 自動的なネットワーク対応

- **動的ホスト名解決**: IPアドレスが変わってもSocket.IO接続が自動的に適切なサーバーに接続
- **全インターフェースバインド**: Next.js開発サーバーが`0.0.0.0`でバインドされ、どのネットワークインターフェースからでもアクセス可能
- **設定変更不要**: IPアドレスの変更時でも追加設定なしで利用可能

### 企業環境での利用

企業ネットワークやプロキシ環境での利用の場合：
- IT部門にポート3000、3001のアクセス許可を確認
- 必要に応じてWindowsファイアウォールやWSLポートフォワーディングを設定

## 使用方法

### 基本的な使い方
1. ホームページでRoomを作成または既存のルームに参加
2. **質問**と**コメント**を分けて投稿（それぞれ専用の入力欄）
3. **Shift+Enter**で改行、**Enter**で送信
4. 反応ボタン（へぇ、いいね、？？？、ぱちぱち）をクリックして反応を送信
5. 反応は画面背景に色分けされたフローティングアニメーションで表示

### 回答システム（質問のみ）
1. 質問投稿の「回答」ボタンをクリック
2. 回答を入力して投稿（改行も可能）
3. 回答がある質問には青いバッジが表示される
4. 既存の回答も確認可能

### 会話ログエクスポート
1. Room画面で「会話をエクスポート」ボタンをクリック
2. JSON形式のファイルが自動ダウンロード
3. ファイルには投稿内容、回答、タイムスタンプが含まれる

## UI改善点（v2.1）

- **投稿分類**: 質問（青）とコメント（緑）を色分けして表示
- **スクロール機能**: 過去の投稿をスクロールして確認、美しいスクロールバー
- **改行対応**: Shift+Enterで改行、whitespace-pre-wrapで改行を保持
- **色分け反応**: へぇ（オレンジ）、いいね（赤）、？？？（黄）、ぱちぱち（緑）
- **文字の可読性向上**: 入力欄の文字色を濃く、プレースホルダーも見やすく
- **回答ボタン**: 質問に明確な回答ボタンを追加

## 本番環境デプロイ（Render）

### 自動デプロイ設定
- **公開URL**: https://wai-chat.onrender.com/
- **本番コマンド**: `npm run start`（Socket.IOサーバー + Next.jsを同時起動）
- **ポート設定**: 
  - Next.jsサーバー: `$PORT`（例: 10000）
  - Socket.IOサーバー: `$PORT + 1`（例: 10001）

### 本番環境での仕様
- 環境変数`NODE_ENV=production`で本番モードを判定
- Socket.IO接続はNext.jsプロキシ経由で内部ポート10001にルーティング
- 外部ポート制限を回避してフロントエンドは`window.location.origin`で接続
- Next.jsリライトルールが`/socket.io/*`を内部的にSocket.IOサーバーに転送

## 注意事項

- Socket.IOサーバーとNext.jsサーバーの両方を起動する必要があります
- 開発環境では同一ネットワーク内でのみ利用可能です
- Roomのデータはメモリ上に保存されるため、サーバー再起動時に消去されます
- 会話ログは手動でエクスポートする必要があります（自動保存機能なし）

## ファイル構造

```
src/
├── app/
│   ├── page.tsx              # ホームページ（ルーム作成・参加）
│   ├── room/[roomId]/
│   │   └── page.tsx          # Roomインターフェース
│   └── globals.css           # TailwindCSS imports
├── server.ts                 # Socket.IOサーバー（回答・エクスポート機能含む）
└── ...
```

## 開発者向け情報

### 新機能の実装詳細（v2.1）
- 投稿分類: `type: 'question' | 'comment' | 'reaction'`で投稿を分類
- 質問専用回答: 質問タイプのみに回答ボタンと回答機能を提供
- 改行対応: textareaでShift+Enterの改行、onKeyDownで制御
- スクロール機能: maxHeight制限とカスタムCSSスクロールバー
- 色分け反応: 反応ごとに異なるTailwindCSSカラーを適用
- UI改善: text-gray-900で入力文字を濃く、placeholder-gray-500で視認性向上

### Socket.IOイベント
- `send-reaction`: 反応・質問・コメントの送信（typeで分類）
- `send-reply`: 回答の送信（質問のみ）
- `export-chat`: 会話ログのエクスポート
- `message-updated`: 回答追加時のメッセージ更新通知